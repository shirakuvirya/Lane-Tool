<!DOCTYPE html>
<html lang="en">

<!-- ========================================================================
     VIRYAOS LANE STUDIO - MAIN HTML DOCUMENT
     
     Professional lane editing application for autonomous vehicles
     Developed by: Virya Autonomous Technologies Pvt Ltd
     Copyright (c) 2025 Virya Autonomous Technologies Pvt Ltd. All rights reserved.
     
     This HTML document provides the complete user interface structure for
     ViryaOS Lane Studio, featuring:
     - 3D point cloud visualization viewport
     - Multi-tab interface for different editing modes
     - Professional tool panels with contextual controls
     - Real-time coordinate display and status information
     - Modal dialogs for text input and configuration
     ======================================================================== -->

<head>
    <!-- ====================================================================
         DOCUMENT METADATA & CONFIGURATION
         Essential document setup, viewport configuration, and external dependencies
         ==================================================================== -->
    
    <meta charset="utf-8">
    <title>ViryaOS Lane Studio - Advanced Lane Editing for Autonomous Vehicles</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Professional lane editing application for autonomous vehicle development by Virya Autonomous Technologies">
    <meta name="author" content="Virya Autonomous Technologies Pvt Ltd">

    <!-- External Dependencies -->
    <!-- SQL.js for SQLite database operations in the browser -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.10.3/sql-wasm.js"></script>

    <!-- Three.js Import Map for ES6 module loading -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
            "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/"
        }
    }
    </script>

    <!-- Application Stylesheet -->
    <link rel="stylesheet" href="main.css">
</head>

<body>
    <!-- ====================================================================
         MAIN APPLICATION STRUCTURE
         Core application layout with 3D viewport and UI overlays
         ==================================================================== -->

    <!-- 3D Rendering Viewport -->
    <!-- Primary container for Three.js WebGL renderer -->
    <div id="app" title="3D Point Cloud Visualization Viewport"></div>

    <!-- Selection Marquee Box -->
    <!-- Visual feedback for drag-to-select operations -->
    <div id="selection-box" title="Selection Area Indicator"></div>

    <!-- Loading Indicator -->
    <!-- Displays during file loading and processing operations -->
    <div id="loader">Loading ViryaOS Lane Studio...</div>

    <!-- ====================================================================
         TOP NAVIGATION BAR
         Main application tabs and file loading controls
         ==================================================================== -->
    
    <div id="top-tabs">
        <!-- Tab Navigation -->
        <!-- Primary mode switching interface -->
        <div class="tab-nav">
            <button id="tab-view" class="tab-button active" title="View and navigate point clouds">
                <span class="tab-icon">üì∑</span>
                View
            </button>
            <button id="tab-waypoint-edit" class="tab-button" title="Edit individual waypoints">
                <span class="tab-icon">‚Ä¢‚Äî‚Ä¢</span>
                Waypoint Edit
            </button>
            <button id="tab-lane-edit" class="tab-button" title="Generate and modify lane boundaries">
                <span class="tab-icon">/‚îÜ\</span>
                Lane Edit
            </button>
            <button id="tab-layout-drawings" class="tab-button" title="Add annotations and layout elements">
                <span class="tab-icon">üìê</span>
                Layout Drawings
            </button>
        </div>

        <!-- File Loading Controls -->
        <!-- Import point clouds and waypoint databases -->
        <div id="file-control">
            <label class="file-label" title="Load point cloud files (PCD/PLY format)">
                üìÅ Load PCD/PLY
                <input type="file" id="pcd-file" accept=".pcd,.ply" multiple>
            </label>
            <label class="file-label" title="Load waypoint database (SQLite format)">
                üóÑÔ∏è Load Database
                <input type="file" id="db-file" accept=".db,.sqlite,.sqlite3">
            </label>
        </div>
    </div>

    <!-- ====================================================================
         WAYPOINT EDITING INTERFACE
         Left and right panels for waypoint manipulation tools and information
         ==================================================================== -->

    <!-- Left Panel: Waypoint Tools -->
    <!-- Primary tool selection and interpolation controls -->
    <div id="left-panel" class="side-panel hidden">
        <div class="panel-header">
            <h3>Waypoint Tools</h3>
        </div>

        <!-- Core Editing Tools -->
        <div class="tool-section">
            <h4>Edit Tools</h4>
            <div class="tool-grid">
                <button id="tool-add-points" class="tool-button" title="Add waypoints by clicking on the map">
                    <span class="tool-icon">‚ûï</span>
                    Add Points
                </button>
                <button id="tool-remove-points" class="tool-button" title="Remove waypoints by clicking on them">
                    <span class="tool-icon">üóëÔ∏è</span>
                    Remove Points
                </button>
                <button id="tool-move-points" class="tool-button" title="Select and drag waypoints to new positions">
                    <span class="tool-icon">üîÑ</span>
                    Move Points
                </button>
                <button id="tool-interpolate" class="tool-button" title="Create smooth paths between waypoints">
                    <span class="tool-icon">üìà</span>
                    Interpolate
                </button>
                <button id="tool-draw-points" class="tool-button" title="Draw a line of waypoints by dragging (W)">
                    <span class="tool-icon">‚úèÔ∏è</span>
                    Draw Points
                </button>
                <button id="tool-two-way" class="tool-button" title="Mark a path of points as two-way">
                    <span class="tool-icon">üîÑ</span>
                    Two Way
                </button>
            </div>
        </div>
        <div id="two-way-panel" class="tool-section hidden">
            <h4>Two-Way Path</h4>
            <p id="two-way-info" class="panel-hint">Select a start and end point to define a path.</p>
            <div class="actions">
                <button id="mark-two-way" class="action-btn success" disabled 
                        title="Mark all selected points as two-way">
                    Mark as Two-Way
                </button>
            </div>
        </div>
        <!-- Advanced Interpolation Controls -->
        <!-- Appears when interpolation tool is active -->
        <div id="interpolation-panel" class="tool-section hidden">
            <h4>Path Interpolation</h4>
            <p id="interpolation-info" class="panel-hint">Select a path of 3 or more points to interpolate.</p>
            
            <!-- Linear Interpolation -->
            <div class="actions">
                <button id="linear-interpolate" class="action-btn success" disabled 
                        title="Create straight-line interpolation between selected points">
                    Linear Interpolate
                </button>
            </div>
            
            <!-- Radial (Bezier Curve) Interpolation -->
            <h4 style="margin-top: 20px;">Radial Interpolation</h4>
            <div class="control-group">
                <label for="radial-strength">Curve Strength</label>
                <input type="range" id="radial-strength" min="-5" max="5" step="0.1" value="0" disabled
                       title="Adjust the curvature of the interpolated path">
                <input type="text" id="radial-strength-value" value="0.00" 
                       style="width: 50px; text-align: center;" disabled>
            </div>
        </div>

        <!-- Keyboard Shortcuts Reference -->
        <div class="tool-section">
            <h4>Keyboard Shortcuts</h4>
            <div class="shortcuts-info">
                <p><kbd>A</kbd> - Add Points Tool</p>
                <p><kbd>D</kbd> - Remove Points Tool</p>
                <p><kbd>M</kbd> - Move Points Tool</p>
                <p><kbd>I</kbd> - Interpolate Tool</p>
                <p><kbd>ESC</kbd> - Clear Selection</p>
                <p><kbd>Del</kbd> - Delete Selected Points</p>
            </div>
        </div>
    </div>

    <!-- Right Panel: Waypoint Information -->
    <!-- Real-time waypoint data display and statistics -->
    <div id="right-panel" class="side-panel hidden">
        <div class="panel-header">
            <h3>Waypoint Information</h3>
        </div>

        <!-- Individual Waypoint Details -->
        <!-- Shows coordinates and properties of hovered waypoint -->
        <div id="waypoint-info" class="info-section hidden">
            <h4>Selected Waypoint</h4>
            <div class="coord-display">
                <div class="coord-row">
                    <label>Database ID:</label>
                    <span id="waypoint-id">-</span>
                </div>
                <div class="coord-row">
                    <label>X Coordinate:</label>
                    <span id="coord-x">0.000</span>
                </div>
                <div class="coord-row">
                    <label>Y Coordinate:</label>
                    <span id="coord-y">0.000</span>
                </div>
                <div class="coord-row">
                    <label>Z Coordinate:</label>
                    <span id="coord-z">0.000</span>
                </div>
            </div>
        </div>

        <!-- Application Features Guide -->
        <div class="info-section">
            <h4>ViryaOS Lane Studio Features</h4>
            <div class="instructions">
                <p>üéØ <strong>Hover Detection:</strong> Cyan ring appears around waypoints</p>
                <p>üîç <strong>Visual Feedback:</strong> Real-time coordinate display</p>
                <p>üñ±Ô∏è <strong>Point Selection:</strong> Click waypoints to select and edit</p>
                <p>‚å®Ô∏è <strong>Keyboard Shortcuts:</strong> Quick tool access and commands</p>
                <p>‚ûï <strong>Point Addition:</strong> Click anywhere on the map to add waypoints</p>
                <p>üîÑ <strong>Drag Operations:</strong> Move points with mouse drag</p>
                <p>üìà <strong>Path Smoothing:</strong> Advanced interpolation algorithms</p>
            </div>
        </div>

        <!-- Project Statistics -->
        <div class="info-section">
            <h4>Project Statistics</h4>
            <div class="stats-display">
                <div class="stat-row">
                    <label>Total Waypoints:</label>
                    <span id="waypoint-count">0</span>
                </div>
            </div>
        </div>
    </div>

    <!-- ====================================================================
         LANE EDITING INTERFACE
         Specialized tools for generating and modifying vehicle lane boundaries
         ==================================================================== -->

    <!-- Left Panel: Lane Generation Tools -->
    <div id="left-lane-panel" class="side-panel hidden">
        <div class="panel-header">
            <h3>Lane Generation Tools</h3>
        </div>
        
        <!-- Vehicle Configuration and Lane Generation -->
        <div class="tool-section">
            <h4>Vehicle Configuration</h4>
            <div class="lane-control">
                <label for="vehicle-select">Vehicle Type:</label>
                <select id="vehicle-select" title="Select vehicle type to determine lane width">
                    <option value="0.5">AMR-10 (0.5m width)</option>
                    <option value="0.75">ARM-50 (0.75m width)</option>
                    <option value="1.0" selected>Buggy (1.0m width)</option>
                </select>
            </div>
            
            <!-- Lane Generation Actions -->
            <div class="actions">
                <button id="generate-lane" class="action-btn action-gen-lane" 
                        title="Generate lane boundaries based on waypoints and vehicle width">
                    Generate Lane
                </button>
            </div>
            <div class="actions">
                <button id="delete-lane" class="action-btn action-del-lane" 
                        title="Remove all generated lane boundaries">
                    üóëÔ∏è Delete Generated Lane
                </button>
            </div>
        </div>

        <!-- Advanced Lane Width Editing -->
        <div class="tool-section">
            <h4>Lane Width Editing</h4>
            <div class="actions">
                <button id="tool-edit-lane" class="action-btn action-gen-lane" 
                        title="Select two waypoints to modify lane width between them">
                    Change Lane Width
                </button>
            </div>
            
            <!-- Segment Width Controls -->
            <!-- Appears when two waypoints are selected for width editing -->
            <div id="lane-width-editor" class="tool-section hidden">
                <h4>Segment Width Configuration</h4>
                
                <!-- Left Side Width Control -->
                <div class="panel-control">
                    <label for="left-lane-width-input">Left Width (m):</label>
                    <div class="stepper-input">
                        <button id="left-width-decrease-btn" title="Decrease left width by 0.05m">&minus;</button>
                        <input type="text" id="left-lane-width-input" value="0.50">
                        <button id="left-width-increase-btn" title="Increase left width by 0.05m">&plus;</button>
                    </div>
                </div>
                
                <!-- Right Side Width Control -->
                <div class="panel-control">
                    <label for="right-lane-width-input">Right Width (m):</label>
                    <div class="stepper-input">
                        <button id="right-width-decrease-btn" title="Decrease right width by 0.05m">&minus;</button>
                        <input type="text" id="right-lane-width-input" value="0.50">
                        <button id="right-width-increase-btn" title="Increase right width by 0.05m">&plus;</button>
                    </div>
                </div>
            </div>
            
            <!-- Lane Segment Information Display -->
            <div id="lane-edit-info" class="info-display hidden">
                <!-- Dynamically populated with selected waypoint information -->
            </div>
        </div>
    </div>

    <!-- Right Panel: Lane Information -->
    <div id="right-lane-panel" class="side-panel hidden">
        <div class="panel-header">
            <h3>Lane Information</h3>
        </div>
        <!-- Lane statistics and properties will be displayed here -->
    </div>

    <!-- ====================================================================
         LAYOUT DRAWINGS INTERFACE
         Annotation tools for adding shapes, text, and layout elements
         ==================================================================== -->

    <!-- Left Panel: Drawing Tools -->
    <div id="left-layout-panel" class="side-panel hidden">
        <div class="panel-header">
            <h3>Layout & Annotation Tools</h3>
        </div>
        
        <!-- Shape Creation Tools -->
        <div class="tool-section">
            <h4>Add Elements</h4>
            <div class="tool-grid">
                <button id="tool-add-square" class="tool-button" title="Draw rectangular shapes">
                    <span class="tool-icon">‚ñ≠</span>
                    Rectangle
                </button>
                <button id="tool-add-oval" class="tool-button" title="Draw circular and oval shapes">
                    <span class="tool-icon">‚ö™</span>
                    Oval
                </button>
                <button id="tool-add-arrow" class="tool-button" title="Draw directional arrows">
                    <span class="tool-icon">‚¨ÜÔ∏è</span>
                    Arrow
                </button>
                <button id="tool-add-line" class="tool-button" title="Draw straight lines">
                    <span class="tool-icon">üìè</span>
                    Line
                </button>
            </div>
            
            <!-- Text Insertion Tool -->
            <div class="actions">
                <button id="layout-insert-text" class="action-btn action-gen-lane" 
                        title="Add text labels to the layout">
                    Insert Text Label
                </button>
            </div>
        </div>

        
        <!-- Element Editing Tools -->
        <div class="tool-section">
            <h4>Edit Elements</h4>
            <div class="tool-grid">
                <button id="tool-select-shape" class="tool-button-layout" 
                        title="Select shapes for moving and resizing">
                    <span class="tool-icon">üñêÔ∏è</span>
                    Select & Transform
                </button>
                <button id="layout-delete-element" class="tool-button-layout" 
                        title="Delete the currently selected element">
                    <span class="tool-icon">üóëÔ∏è</span>
                    Delete Selected
                </button>
                <button id="layout-edit-text" class="tool-button-layout" 
                        title="Edit the text content of selected text elements">
                    <span class="tool-icon">‚úèÔ∏è</span>
                    Edit Text
                </button>
            </div>
            
            <!-- Style Customization Controls -->
            <!-- Appears when an element is selected -->
            <div id="style-controls" class="tool-section hidden">
                <h4>Element Styling</h4>
                
                <!-- Shape Style Controls -->
                <div id="shape-style-controls" class="color-palette hidden">
                    <div class="color-control">
                        <label for="fill-color">Fill Color</label>
                        <input type="color" id="fill-color" value="#4a9eff" 
                               title="Change the fill color of the selected shape">
                    </div>
                    <div class="color-control">
                        <label for="shape-opacity">Opacity</label>
                        <div class="slider-container">
                            <input type="range" id="shape-opacity" min="0" max="1" step="0.01" value="0.7"
                                   title="Adjust the transparency of the selected shape">
                            <span id="shape-opacity-value">0.70</span>
                        </div>
                    </div>
                </div>
                
                <!-- Text Style Controls -->
                <div id="text-style-controls" class="color-palette hidden">
                    <div class="color-control">
                        <label for="text-color">Text Color</label>
                        <input type="color" id="text-color" value="#ffffff"
                               title="Change the color of the selected text">
                    </div>
                    <div class="color-control">
                        <label for="text-size">Text Size</label>
                        <div class="slider-container">
                            <input type="range" id="text-size" min="0.1" max="5" step="0.05" value="0.5"
                                   title="Adjust the size of the selected text">
                            <span id="text-size-value">0.50</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Right Panel: Layout Information -->
    <div id="right-layout-panel" class="side-panel hidden">
        <div class="panel-header">
            <h3>Layout Information</h3>
        </div>
        <!-- Layout element properties and statistics will be displayed here -->
    </div>

    <!-- ====================================================================
         REAL-TIME INFORMATION DISPLAY
         Coordinate tracking and status information
         ==================================================================== -->

    <!-- Mouse Coordinate Display -->
    <!-- Shows real-time world coordinates under mouse cursor -->
    <div id="hover-coords" title="Real-time world coordinates under cursor"></div>

    <!-- ====================================================================
         BOTTOM CONTROL BAR
         Global visualization and rendering controls
         ==================================================================== -->
    
    <div id="bottom-controls">
        <!-- Point Cloud Visualization Controls -->
        <div class="control-group">
            <label>Point Size:</label>
            <input type="range" id="point-size" min="0.1" max="5" step="0.1" value="0.5"
                   title="Adjust the size of point cloud points">
            <span id="size-value">0.5</span>
        </div>

        <div class="control-group">
            <label>Voxel Size:</label>
            <input type="range" id="voxel-size" min="0.1" max="5" step="0.1" value="1.0"
                   title="Adjust the voxel size multiplier for point cloud rendering">
            <span id="voxel-value">1.0</span>
        </div>

        <div class="control-group">
            <label>Opacity:</label>
            <input type="range" id="opacity" min="0" max="1" step="0.01" value="1"
                   title="Adjust the transparency of the point cloud and waypoints">
            <span id="opacity-value">1.0</span>
        </div>

        <!-- Waypoint Visualization Controls -->
        <div class="control-group">
            <label>Waypoint Size:</label>
            <input type="range" id="waypoint-size" min="0.01" max="0.5" step="0.005" value="0.05"
                   title="Adjust the size of waypoint markers">
            <span id="waypoint-size-value">0.05</span>
        </div>

        <!-- Color and View Mode Controls -->
        <div class="control-group">
            <label>Color Mode:</label>
            <select id="color-mode" title="Select point cloud coloring method">
                <option value="default">Default White</option>
                <option value="height">Height-based (Z-axis)</option>
            </select>
        </div>

        <div class="control-group">
            <label>View Mode:</label>
            <select id="view-mode" title="Select camera view mode">
                <option value="orbit">3D Orbit View</option>
                <option value="top">Top-down View</option>
            </select>
        </div>
    </div>

    <!-- ====================================================================
         MODAL DIALOGS
         Text input and configuration dialogs
         ==================================================================== -->

    <!-- Text Input Modal -->
    <!-- Used for entering text labels and editing existing text -->
    <div id="text-input-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h3 id="modal-title">Enter Label Text</h3>
            <input type="text" id="text-input-field" placeholder="Enter your text here..."
                   title="Type the text content for your label">
            <div class="modal-actions">
                <button id="text-input-cancel" class="action-btn action-del-lane" 
                        title="Cancel text input and close dialog">
                    Cancel
                </button>
                <button id="text-input-confirm" class="action-btn success" 
                        title="Confirm text input and create/update label">
                    Confirm
                </button>
            </div>
        </div>
    </div>

    <!-- ====================================================================
         APPLICATION INITIALIZATION
         Load and start the ViryaOS Lane Studio application
         ==================================================================== -->
    
    <!-- Main Application Script -->
    <script type="module" src="app.js"></script>
</body>
</html>